<div class="max-w-4xl mx-auto px-6 py-12">
  <h1 class="text-2xl font-medium text-neutral-900 mb-8">AI 使用量統計</h1>

  <!-- 點數卡片 -->
  <div class="grid md:grid-cols-3 gap-6 mb-12">
    <!-- 剩餘點數 -->
    <div class="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl p-6 text-white">
      <div class="text-sm opacity-80 mb-1">剩餘點數</div>
      <div class="text-4xl font-bold"><%= @stats[:credits_remaining] %></div>
      <% if @stats[:byok] %>
        <div class="mt-2 px-2 py-1 bg-white/20 rounded-full text-xs inline-block">
          🔑 使用自有 API Key
        </div>
      <% end %>
    </div>

    <!-- 今日使用 -->
    <div class="bg-white border border-neutral-200 rounded-2xl p-6">
      <div class="text-sm text-neutral-500 mb-1">今日使用</div>
      <div class="text-3xl font-bold text-neutral-900"><%= @stats[:today_usage] %></div>
      <div class="text-sm text-neutral-400 mt-1">點</div>
    </div>

    <!-- 本月使用 -->
    <div class="bg-white border border-neutral-200 rounded-2xl p-6">
      <div class="text-sm text-neutral-500 mb-1">本月使用</div>
      <div class="text-3xl font-bold text-neutral-900"><%= @stats[:month_usage] %></div>
      <div class="text-sm text-neutral-400 mt-1">點</div>
    </div>
  </div>

  <!-- 點數說明 -->
  <div class="bg-neutral-50 rounded-2xl p-6 mb-12">
    <h2 class="text-lg font-medium text-neutral-900 mb-4">點數消耗說明</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">探索模式對話</span>
        <span class="font-medium">2 點/次</span>
      </div>
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">智慧搜尋</span>
        <span class="font-medium">1 點/次</span>
      </div>
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">商品比較</span>
        <span class="font-medium">3 點/次</span>
      </div>
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">智慧預覽</span>
        <span class="font-medium">2 點/次</span>
      </div>
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">購買決策助手</span>
        <span class="font-medium">3 點/次</span>
      </div>
      <div class="flex items-center justify-between py-2 border-b border-neutral-200">
        <span class="text-neutral-600">MVT 驗證</span>
        <span class="font-medium">5 點/次</span>
      </div>
    </div>

    <div class="mt-6 p-4 bg-purple-50 rounded-xl">
      <p class="text-sm text-purple-700">
        <strong>💡 提示：</strong>
        設定自己的 Gemini API Key 後，所有 AI 功能將免費使用，不消耗點數！
        <%= link_to "前往設定", settings_path, class: "underline" %>
      </p>
    </div>
  </div>

  <!-- 交易記錄 -->
  <div class="bg-white border border-neutral-200 rounded-2xl p-6">
    <h2 class="text-lg font-medium text-neutral-900 mb-4">最近交易記錄</h2>

    <% if @transactions.any? %>
      <div class="divide-y divide-neutral-100">
        <% @transactions.each do |tx| %>
          <div class="flex items-center justify-between py-3">
            <div>
              <div class="font-medium text-neutral-900">
                <%= action_type_label(tx.action_type) %>
              </div>
              <div class="text-sm text-neutral-400">
                <%= tx.created_at.strftime("%Y/%m/%d %H:%M") %>
              </div>
            </div>
            <div class="<%= tx.amount >= 0 ? 'text-green-600' : 'text-red-600' %> font-medium">
              <%= tx.amount >= 0 ? '+' : '' %><%= tx.amount %> 點
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-center text-neutral-400 py-8">暫無交易記錄</p>
    <% end %>
  </div>
</div>

<%
def action_type_label(type)
  labels = {
    "explore" => "🔍 探索對話",
    "search" => "🔎 智慧搜尋",
    "compare" => "⚖️ 商品比較",
    "smart_preview" => "👁️ 智慧預覽",
    "decision_assist" => "🤔 購買決策",
    "mvt_validation" => "✅ MVT 驗證",
    "top_up" => "💰 儲值",
    "bonus" => "🎁 贈送",
    "refund" => "↩️ 退款"
  }
  labels[type] || type
end
%>
